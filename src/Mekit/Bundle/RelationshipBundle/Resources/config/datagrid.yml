datagrid:

    # filters out all entities of a given class which reference OR is referred to by a specific ReferenceableElement (entity_id)
    #@todo: implement "direction" -> is entity "referenced" OR "referred to by"
    relationship-related-element-source-logic:
        source:
            type:           orm
            query:
                select:
                    - referenceableElement.id as refId
                    - CASE WHEN RE_reference IS NOT NULL THEN 'IN' ELSE 'OUT' END as referenceDirection
                # This must be set by the extending datagrid with alias "e"
                #from:
                   #- { table: 'Mekit\Bundle\ContactBundle\Entity\Contact', alias: e }
                join:
                    inner:
                        - { join: e.referenceableElement, alias: referenceableElement }
                    left:
                        - { join: referenceableElement.references, alias: RE_reference }
                        - { join: referenceableElement.referrals, alias: RE_referral }
                where:
                    and:
                        - (RE_reference.id = :ref_el_id OR RE_referral.id = :ref_el_id)
            bind_parameters:
                - ref_el_id
        columns:
            direction:
                data_name:      referenceDirection
                label:          mekit.relationship.direction.label
                type:           twig
                frontend_type:  html
                template:       MekitRelationshipBundle:Relationship:Datagrid/Property/directionIcon.html.twig




    # filters out all entities of a given class which reference OR are referred to a specific ReferenceableElement (entity_id) - INVERSED LOGIC
    # More difficult to extend and probably slower
    relationship-related-element-source-logic-inversed:
        source:
            type:           orm
            query:
                select:
                    - referenceableElement.id as refId
                from:
                    - { table: %mekit_relationship.referenceable_element.entity.class%, alias: referenceableElement }
                join:
                    left:
                        - { join: referenceableElement.references, alias: RE_reference }
                        - { join: referenceableElement.referrals, alias: RE_referral }
                    # This should be set by the extending datagrid
                    #inner:
                        #-
                            #join: 'Mekit\Bundle\ContactBundle\Entity\Contact'
                            #alias: e
                            #conditionType: WITH
                            #condition: "referenceableElement = e.referenceableElement"
                where:
                    and:
                        #- referenceableElement.type = 'Mekit\Bundle\ContactBundle\Entity\Contact' # this is not necessary
                        - (RE_reference.id = :ref_el_id OR RE_referral.id = :ref_el_id)

            bind_parameters:
                - ref_el_id